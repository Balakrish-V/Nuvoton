#include "numicro_8051.h"

BIT BIT_TMP;

uint8_t data TA_REG_TMP, BYTE_TMP, SFRS_TMP;
uint8_t data dtemp _at_ 0x70;
uint8_t idata itemp _at_ 0x90;
uint8_t xdata xtemp _at_ 0x90;

/**
 * Read Dataflash
 */
uint8_t Read_APROM_BYTE(uint16_t code *u16_addr)
{
    uint8_t rdata;
    rdata = *u16_addr >> 8;
    return rdata;
}

/**
 * Software reset
 */
void Software_Reset(uint8_t u8Bootarea)
{
    uint8_t boottemp;
    boottemp = (0x80 | u8Bootarea);
    TA = 0xAA;
    TA = 0x55;
    CHPCON = boottemp;
}

/**
 * MCU power down mode
 */
void PowerDown_Mode(uint8_t PDStatus)
{
    if (PDStatus)
    {
       ENABLE_POWERDOWN_MODE;
       CALL_NOP;
       CALL_NOP;
    }
}

/**
 * MCU idle mode
 */
void Idle_Mode(uint8_t IdleStatus)
{
    if (IdleStatus)
    {
       ENABLE_IDLE_MODE;
       CALL_NOP;
       CALL_NOP;
    }
}

/**
 * Software loop delay ~3ms
 */
void _delay_(void)
{
    uint8_t t1, t2;
    for (t2 = 0; t2 < 0x1A; t2++)
    {
       for (t1 = 0; t1 < 0x7F; t1++)
       {
          CALL_NOP;
       }
    }
}

/**
 * Global interrupt control
 */
void Global_Interrupt(uint8_t u8IntStatus)
{
    EA = u8IntStatus;
}
